<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admin ‚Äì Campus Feedback</title>
  <style>
    /* Basic styling & layout */
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top left, #1d4ed8, #020617);
      color: #e5e7eb;
    }

    .shell {
      width: 90%;
      max-width: 960px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 24px;
      padding: 22px 24px 20px;
      box-shadow: 0 18px 50px rgba(15, 23, 42, 0.8);
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 16px;
      margin-bottom: 12px;
    }

    .title {
      font-size: 22px;
      font-weight: 650;
      margin: 0;
      color: #f9fafb;
    }

    .subtitle {
      font-size: 12px;
      color: #9ca3af;
      margin: 2px 0 0;
    }

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 7px 18px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: #2563eb;
      color: white;
      box-shadow: 0 8px 22px rgba(37, 99, 235, 0.6);
      transition: 0.07s ease;
      white-space: nowrap;
    }
    .btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.9);
    }

    label {
      font-size: 13px;
      color: #d1d5db;
      margin-right: 4px;
    }

    select {
      border-radius: 999px;
      border: 1px solid #4b5563;
      padding: 6px 10px;
      font-size: 13px;
      background: #020617;
      color: #f9fafb;
      outline: none;
    }

    .status {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
      min-height: 16px;
    }
    .status.ok { color: #4ade80; }
    .status.err { color: #f87171; }

    .table-wrapper {
      margin-top: 8px;
      max-height: 360px;
      overflow: auto;
      border-radius: 14px;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.9);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    thead {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }
    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #111827;
    }
    th {
      text-align: left;
      font-weight: 600;
      color: #9ca3af;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    tr:nth-child(even) td {
      background: rgba(15, 23, 42, 0.9);
    }
    tr:nth-child(odd) td {
      background: rgba(15, 23, 42, 0.8);
    }

    .pill {
      display: inline-flex;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      font-size: 11px;
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .feedback-cell {
      color: #e5e7eb;
      max-width: 420px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .date-cell {
      font-size: 12px;
      color: #9ca3af;
      white-space: nowrap;
    }

    @media (max-width: 720px) {
      .shell {
        padding: 18px 16px;
      }
      .header-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .feedback-cell {
        max-width: 260px;
      }
    }
  </style>
</head>
<body>
  <main class="shell">
    <div class="header-row">
      <div>
        <h1 class="title">Admin ‚Äì Feedback List</h1>
        <p class="subtitle">
          View anonymous feedback submitted to the kiosk. Use the category filter to focus on specific areas.
        </p>
      </div>
    </div>

    <div class="controls">
      <button class="btn" onclick="loadFeedback()">Refresh</button>

      <div>
        <label for="categoryFilter">Category:</label>
        <select id="categoryFilter" onchange="applyFilter()">
          <option value="All">All</option>
          <option value="Facilities">Facilities</option>
          <option value="Classroom">Classroom</option>
          <option value="Canteen">Canteen</option>
          <option value="Library">Library</option>
          <option value="Other">Other</option>
          <!-- Uncategorised removed -->
        </select>
      </div>
    </div>

    <div id="status" class="status">Click ‚ÄúRefresh‚Äù to load feedback.</div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th style="width: 120px;">Category</th>
            <th>Feedback</th>
            <th style="width: 180px;">Created At (UTC)</th>
          </tr>
        </thead>
        <tbody id="feedbackBody">
          <!-- rows injected here -->
        </tbody>
      </table>
    </div>
  </main>

  <script>
    const API_URL = "https://wushi4vbqc.execute-api.us-east-1.amazonaws.com/prod/feedback";
    let allItems = []; // stores loaded feedback items
    
    // Fetch feedback from API
    async function loadFeedback() {
      const status = document.getElementById("status");
      const tbody = document.getElementById("feedbackBody");

      status.textContent = "Loading feedback‚Ä¶";
      status.className = "status";
      tbody.innerHTML = "";

      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        allItems = Array.isArray(data) ? data : [];
        if (allItems.length === 0) {
          status.textContent = "No feedback found.";
          status.classList.add("ok");
        } else {
          status.textContent = `Loaded ${allItems.length} feedback item(s).`;
          status.classList.add("ok");
        }
        applyFilter(); // update table
      } catch (err) {
        console.error(err);
        status.textContent = "Error loading feedback. Please try again.";
        status.classList.add("err");
      }
    }

    // Filter feedback by category and render table
    function applyFilter() {
      const filter = document.getElementById("categoryFilter").value;
      const tbody = document.getElementById("feedbackBody");
      tbody.innerHTML = "";

      const items = allItems.filter(item => {
        // üîπ KEY CHANGE: if item.category is missing, treat it as "Other"
        const cat = item.category || "Other"; // fallback
        if (filter === "All") return true;
        return cat === filter;
      });

      if (items.length === 0) {
        const row = document.createElement("tr");
        const cell = document.createElement("td");
        cell.colSpan = 3;
        cell.textContent = "No feedback for this category.";
        cell.style.textAlign = "center";
        cell.style.color = "#9ca3af";
        row.appendChild(cell);
        tbody.appendChild(row);
        return;
      }

      items.forEach(item => {
        const tr = document.createElement("tr");

        const catCell = document.createElement("td");
        const pill = document.createElement("span");
        pill.className = "pill";
        // üîπ KEY CHANGE: display "Other" if category is missing
        pill.textContent = item.category || "Other";
        catCell.appendChild(pill);

        const fbCell = document.createElement("td");
        fbCell.className = "feedback-cell";
        fbCell.textContent = item.feedback || "";

        const dateCell = document.createElement("td");
        dateCell.className = "date-cell";
        dateCell.textContent = item.createdAt || "";

        tr.appendChild(catCell);
        tr.appendChild(fbCell);
        tr.appendChild(dateCell);
        tbody.appendChild(tr);
      });
    }

    // Optional: auto-load on open
    // window.addEventListener("load", loadFeedback);
  </script>
</body>
</html>

